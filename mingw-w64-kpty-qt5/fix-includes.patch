diff -urN kpty-5.24.0.orig/CMakeLists.txt kpty-5.24.0/CMakeLists.txt
--- kpty-5.24.0.orig/CMakeLists.txt	2016-07-03 11:22:19.000000000 +0200
+++ kpty-5.24.0/CMakeLists.txt	2016-08-05 00:41:51.343762900 +0200
@@ -42,6 +42,7 @@
 include(ECMSetupVersion)
 include(ECMGenerateHeaders)
 include(ECMPackageConfigHelpers)
+include(ECMMarkNonGuiExecutable)
 
 ecm_setup_version(
   ${KF5_VERSION}
diff -urN kpty-5.24.0.orig/src/kgrantpty.c kpty-5.24.0/src/kgrantpty.c
--- kpty-5.24.0.orig/src/kgrantpty.c	2016-07-03 11:22:19.000000000 +0200
+++ kpty-5.24.0/src/kgrantpty.c	2016-08-05 12:50:20.214086600 +0200
@@ -40,15 +40,33 @@
 
 #include <config-pty.h>
 
-#include <sys/types.h>
+#ifdef _WIN32
+# include <mingw/sys/types.h>
+#else
+# include <sys/types.h>
+#endif
+
 #include <errno.h>
-#include <grp.h>
+
+#ifdef _WIN32
+# include <mingw/grp.h>
+#else
+# include <grp.h>
+#endif
+
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>
 #include <sys/stat.h>
-#include <sys/ioctl.h>
-#include <unistd.h>
+
+#ifdef _WIN32
+# include <mingw/sys/ioctl.h>
+# include <mingw/unistd.h>
+#else
+# include <sys/ioctl.h>
+# include <unistd.h>
+#endif
+
 #if HAVE_PTY_H
 #  include <pty.h>
 #endif
diff -urN kpty-5.24.0.orig/src/kpty.cpp kpty-5.24.0/src/kpty.cpp
--- kpty-5.24.0.orig/src/kpty.cpp	2016-07-03 11:22:19.000000000 +0200
+++ kpty-5.24.0/src/kpty.cpp	2016-08-05 12:49:55.894007500 +0200
@@ -46,9 +46,21 @@
 #endif
 
 #include <sys/types.h>
-#include <sys/ioctl.h>
+
+#ifdef _WIN32
+# include <mingw/sys/ioctl.h>
+#else
+# include <sys/ioctl.h>
+#endif
+
 #include <sys/time.h>
-#include <sys/resource.h>
+
+#ifdef _WIN32
+# include <mingw/sys/resource.h>
+#else
+# include <sys/resource.h>
+#endif
+
 #include <sys/stat.h>
 #include <sys/param.h>
 
@@ -58,8 +70,15 @@
 #include <stdlib.h>
 #include <stdio.h>
 #include <string.h>
-#include <unistd.h>
-#include <grp.h>
+
+#ifdef _WIN32
+# include <mingw/unistd.h>
+# include <mingw/grp.h>
+#else
+# include <unistd.h>
+# include <grp.h>
+#endif
+
 
 #if HAVE_PTY_H
 # include <pty.h>
