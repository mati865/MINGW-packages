From: Ray Donnelly <mingw.android@gmail.com>
Date: Sat, 27 Sep 2014 15:40:36 +0100
Subject: [PATCH 10/14] MSYS2: hasPacmanDatabase() getMSYS2Root() changes

---
diff -urN octopi-0.8.1.orig/src/constants.h octopi-0.8.1/src/constants.h
--- octopi-0.8.1.orig/src/constants.h	2016-04-02 21:23:52.054780900 +0200
+++ octopi-0.8.1/src/constants.h	2016-04-02 21:27:14.374023900 +0200
@@ -84,8 +84,9 @@

 //Package related
 const QString ctn_TEMP_ACTIONS_FILE ( QDir::tempPath() + QLatin1Char('/') + ".qt_temp_" );
-const QString ctn_PACMAN_DATABASE_DIR = "/var/lib/pacman";
-const QString ctn_PACMAN_CORE_DB_FILE = "/var/lib/pacman/sync/core.db";
+const QString ctn_PACMAN_DATABASE_DIR  = "/var/lib/pacman";
+const QString ctn_PACMAN_CORE_DB_FILE  = "/var/lib/pacman/sync/core.db";
+const QString ctn_PACMAN_MSYS2_DB_FILE = "/var/lib/pacman/sync/msys.db";

 enum PackageStatus { ectn_INSTALLED, ectn_NON_INSTALLED, ectn_OUTDATED, ectn_NEWER,
                      ectn_FOREIGN, ectn_FOREIGN_OUTDATED };

diff -urN octopi-0.8.1.orig/src/package.cpp octopi-0.8.1/src/package.cpp
--- octopi-0.8.1.orig/src/package.cpp	2016-04-02 21:23:52.073788400 +0200
+++ octopi-0.8.1/src/package.cpp	2016-04-02 21:25:17.875505500 +0200
@@ -1394,7 +1394,16 @@
 
   if (!done)
   {
-    QFile f(ctn_PACMAN_CORE_DB_FILE);
+    QString dbFile;
+    if (UnixCommand::getLinuxDistro() == ectn_MSYS2)
+    {
+      dbFile = UnixCommand::getMSYS2Root() + ctn_PACMAN_MSYS2_DB_FILE;
+    }
+    else
+    {
+      dbFile = ctn_PACMAN_CORE_DB_FILE;
+    }
+    QFile f(dbFile);
     answer = f.exists();
     done = true;
   }

